<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" type="image/png" href="title.png" />
<link rel="stylesheet" type="text/css" href="stylesheet.css">
<link href="fontawesome/css/all.css" rel="stylesheet">
<link rel="manifest" crossorigin="use-credentials" href="manifest.json" />
<link rel="apple-touch-icon" href="title.png"/>
<title>F*ck</title>
</head>
<body>
	<div id="overlay" class="overlay">
		<div class="overlay_content">
			<a class="overlay_action" onclick="toggle_overlay();">
				<i class="fas fa-arrow-circle-left"></i>
				<span>Back</span>
			</a>
			<a class="overlay_action" onclick="save();">
				<i class="fas fa-save"></i>
				<span>Save</span>
			</a>
			<a class="overlay_action" onclick="load()" >
				<i class="fas fa-file-upload"></i>
				<span>Load</span>
			</a>
			<a class="overlay_action" onclick="changerounds();">
				<i class="fas fa-sort-amount-up"></i>
				<span>Change rounds</span>
			</a>
			<a class="overlay_action" onclick="toggle_theme();">
				<i class="fas fa-palette"></i>
				<span>Change theme</span>
			</a>
			<a class="overlay_action" onclick="change_quote();">
				<i class="fas fa-quote-left"></i>
				<span>Change Quote</span>
			</a>
			<a class="overlay_action" href="https://ltotheois.github.io/LLWP/imprint.html">
				<i class="fas fa-sync"></i>
				<span>Imprint & Privacy Policy</span>
			</a>
		</div>
		<div id="manual_div">
			
		</div>
		<div id="log_div" class="dgrid">
		</div>
	</div>
			
	<div class="tile" id="table_tile">
		<div class="dgrid">
				<div>
					<button class="button" onclick="toggle_overlay();">Menu</button>
					<button class="button" onclick="newgame(rounds);">New Game</button>
				</div>
				<div class="inline_icon_div">
					<a class="clickable" onclick="document.getElementById('table').classList.toggle('hide_icons')"><i class="fa fa-eye-slash"></i></a>
					<a class="clickable" onclick="document.getElementById('table_tile').classList.toggle('hide_cells')"><i class="fas fa-table"></i></a>
					<a class="clickable" onclick="delete_row(all=true)"><i class="fas fa-trash"></i></a>
				</div>
			</div>
		<div id="table_container">
			<table id="table" class="hide_icons">
				<thead id="table_head">
					<tr>
						<th>#</i></th>
						<th><input id="player1" placeholder="Name"/></th>
						<th><input id="player2" placeholder="Name"/></th>
						<th><input id="player3" placeholder="Name"/></th>
						<th><input id="player4" placeholder="Name"/></th>
					</tr>
				</thead>
				<tbody id="table_body">
				</tbody>
			</table>
		</div>
	</div>

	<div class="tile" id="analysis_tile" style="display: none;">
		<h2>Analysis</h2>
		<div id="table_container_analysis">
		</div>
	</div>
	
	<div id="quote1" class="quote" style="opacity:0;"><span></span></div>
	<div id="quote2" class="quote" style="position:absolute; bottom:0px; left:0px;"><span></span></div>
	
	<script>
	var overlay = document.getElementById('overlay');
	var tablebody = document.getElementById('table_body');
	var rounds = "customrounds" in localStorage ? JSON.parse(localStorage.getItem("customrounds")) : [1,2,3,4,5,6,7,8,8,8,8,7,6,5,4,3,2,1];

	console.log(rounds);

	function newgame(rounds){
		if (tablebody.innerHTML.trim() != ""){
			if (!(confirm('Are you sure you want to start a new game and discard the current game?'))) {
				return;
			}
		}
		
		tablebody.innerHTML = "";
		for (var numberofcards of rounds){
			var row = document.createElement("tr");
			tmp = document.createElement("td");
			tmp.innerHTML = numberofcards;
			row.appendChild(tmp);
			
			for (var i=1; i < 5; i++){
				tmp = document.createElement("td");
				tmp.innerHTML = '<input inputmode="numeric" class="real"/>/<input inputmode="numeric" class="wish"/><span class="score"></span>';
				row.appendChild(tmp);
			}
			
			tablebody.appendChild(row);
		}
		var inputs = document.querySelectorAll(".real, .wish");
		for (var elem of inputs){
			elem.addEventListener("change", function(){getvalues();});
		}
	}

	function getvalues(){
		var data = [];
		var rows = tablebody.children;
		var complete = true;
		
		var hands = [];
		var score = {1: 0, 2: 0, 3: 0, 4: 0};
		var players = {
			1: document.querySelector("#player1").value,
			2: document.querySelector("#player2").value,
			3: document.querySelector("#player3").value,
			4: document.querySelector("#player4").value,
		}
		
		for (var row of rows){
			var cells = row.children;
			var cards = parseInt(cells[0].innerHTML);
			hands.push(cards);
			var wishs = 0;
			var reals = 0;
			var tmp = [];
			for (var i=1; i < 5; i++){
				var cell = cells[i];
				realinput = cell.querySelector(".real");
				wishinput = cell.querySelector(".wish");
				scorespan = cell.querySelector(".score");
				realvalue = parseFloat(realinput.value);
				wishvalue = parseFloat(wishinput.value);

				if (!(isNaN(realvalue) || isNaN(wishvalue))){
					if (realvalue == wishvalue){
						wishinput.classList.remove("mistake");
						realinput.classList.remove("mistake");
						score[i] += 50+10*realvalue
					} else {
						wishinput.classList.add("mistake");
						realinput.classList.add("mistake");
						score[i] -= 10*Math.abs(realvalue-wishvalue);
					}
					
					scorespan.innerHTML = score[i];
				} else {
					complete = false;
					wishinput.classList.remove("mistake");
					realinput.classList.remove("mistake");
				}
				
				wishs += wishvalue;
				reals += realvalue;
				
				tmp.push([realvalue, wishvalue]);
			}
			data.push(tmp);
			
			if ((reals != cards) || (wishs == cards)){
				complete = false;
				cells[0].classList.add("mistake");
			} else {
				cells[0].classList.remove("mistake");
			}
			
		}
		
		if (complete){
			analysis({"players": players, "hands": hands, "data": data});
		}
		
		return({"players": players, "hands": hands, "data": data});
	}

	function setvalues(data){
		var players = data.players;
		var hands   = data.hands;
		var data    = data.data;
		
		for (var i=1; i < 5; i++){
			document.querySelector("#player"+i).value = players[i];
		}
		
		newgame(hands);
		var rows = tablebody.children;
		
		for (var i=0; i < rows.length; i++){
			var row = rows[i];
			var wishcells = row.querySelectorAll(".wish");
			var realcells = row.querySelectorAll(".real");
			
			for (var j=0; j < 4; j++){
				realcells[j].value = data[i][j][0];
				wishcells[j].value = data[i][j][1];
			}
		}
	}

	function toggle_overlay(){
		document.body.classList.toggle('overlayactive');
	}


	function analysis(data){
		var players = data.players;
		var hands   = data.hands;
		var data    = data.data;
		
		<!-- Checke maximale Stichanzahl -->
		<!-- Schaue pro Spieler wie oft Stich angesagt wurde und wie oft erfolgreich -->
		<!-- Finde die höchste einzelne erfolgreiche Anzahl Stiche -->
		<!-- Finde die höchste summierte erfolgreiche Anzahl Stiche -->
		<!-- Tabelle und die einzelnen Highlights -->
		
		console.log("Analysis goes here.");
		
	}

	function save(){
		var data = getvalues();
		var json_string = JSON.stringify(data);
		
		name = "savedgame";
		localStorage.setItem(name, json_string);
	}

	function load(){
		try {
			name = "savedgame";
			data = JSON.parse(localStorage.getItem(name));
			setvalues(data);
			getvalues();
		} catch(err) {
			window.alert("Could not load the data!\nThe error was: " + err);
		}
	}

	function changerounds(){
		var numbers = prompt("Please enter the roundformat", rounds.join(" "));
		numbers = numbers.split(/\s+/);
		numbers = numbers.map(x => parseInt(x));
		localStorage.setItem("customrounds", JSON.stringify(numbers));
		rounds = numbers;
	}

	function toggle_theme(){
		document.documentElement.classList.toggle('light_theme');
		if (document.documentElement.classList.contains("light_theme")){
			localStorage.setItem("light_theme", 1);
		}else{
			localStorage.setItem("light_theme", 0);
		}
	}

	quotes_str = '["Deine Leute alles Platzpatronen,\\nMeine Leute halten stand wie ein Bataillon\\n-Anis M. Y. Ferchichi", "Was sie rappen ist kein Image, das ist Science Fiction\\n-Anis M. Y. Ferchichi", "Erstens kommt es anders und zweitens als man denkt\\n-Ekrem Bora", "In der Theorie willst du was ver\\u00e4ndern, aber in der Praxis geht alles schief.\\nIn der Theorie wollen wir zu viel, geben aber viel zu wenig, das ist kein fairer Deal.\\n-Anis M. Y. Ferchichi & Jochen Burchard", "Und bist du unten, dr\\u00fccken sie dich noch ein St\\u00fcck tiefer\\nNoch ein St\\u00fcck tiefer\\nNoch ein St\\u00fcck tiefer\\nNoch ein St\\u00fcck tiefer\\n-Anis M. Y. Ferchichi", "Da ting goes skrrrrahh, pap, pap, ka-ka-ka\\nSkidiki-pap-pap, and a pu-pu-pudrrrr-boom\\nSkya, du-du-ku-ku-dun-dun\\nPoom, poom, you dun know\\n-Michael Dapaah", "Einstein, my mind, this MC move white squares with my relatives.\\n-Shawn C. Carter", "Man kann es weder sehen noch ber\\u00fchren, lediglich sp\\u00fcren.\\n-Anis M. Y. Ferchichi", "Dank mir ist das Niveau im Keller, so wie Weinf\\u00e4sser\\n-Anis M. Y. Ferchichi", "Meine Punchlines sind w\\u00e4hlerisch, aber dich zers\\u00e4ge ich\\n-Vladislav Balovatsky", "Bratan l\\u00e4uft, Para und Erfolg\\nGestern war\'n die Platten grau, heute sind sie Gold\\n-Vladislav Balovatsky", "Das Leben ist \'ne Schachtel Pralinen\\nUnd alle kriegen das, was sie verdienen\\nEgal, wie schnell du rennst, vor Gott kannst du nicht fliehen\\nInshallah deine S\\u00fcnden werden verziehen\\n-Vladislav Balovatsky", "F\\u00fcr meine Tochter, der ich sp\\u00e4ter mal erz\\u00e4hlen kann\\nIhr Vater war ein Ehrenmann\\n-Anis M. Y. Ferchichi", "Nachts, da schlafe ich\\n-Deutscher Philosoph", "It wasn\'t me\\n-Orville Richard Burrell", "Und du bist, alles f\\u00fcr mich, alles das, was mir Angst macht\\nMeine silberne Kugel, mein Kryptonit und mein Anthrax\\n-Friedrich Kautz", "Jack-Daniel\'s-Eis, Hennessy und Johnnie Walker\\nIch komm\' voll besoffen in \'nem Gucci-Jogger\\n-Vladislav Balovatsky", "There is no such thing as too much duct tape\\n-Oli", "We are going so fast\\nBut time so slow\\n-Theory of Relativity", "D\\u00f6p, d\\u00f6p, d\\u00f6p, d\\u00f6p, d\\u00f6d\\u00f6d\\u00f6d\\u00f6d\\u00f6p\\nD\\u00f6, d\\u00f6d\\u00f6d\\u00f6p, d\\u00f6p, d\\u00f6d\\u00f6d\\u00f6d\\u00f6d\\u00f6p, d\\u00f6p\\n-Hans Peter Geerdes", "Skibadee, skibadanger\\nI am the rearranger\\n-Hans Peter Geerdes", "If we could only slow the time\\nWe would have forever every night\\n-Don Pepijn Schipper", "Meine Stra\\u00dfenpoesie l\\u00f6st die Chaostheorie\\n-Mousa Amouei", "Die Parabel sie steigt, und zwar exponentiell\\n-Mohamed El Moussaoui", "Chuba chuba chuba chuba chuba chuba chubby.\\nI don\'t have any lines to go right here, so chuby Teletubby\\n-Marshall Bruce Mathers III", "Two things are infinite: The universe and human stupidity;\\nand I\\u2018m not sure about the universe\\n-Albert E", "Physics is like sex: sure, it may give some practical results, but that\'s not why we do it.\\n-Richard P. Feynman", "I do not think you can name many great inventions that have been made by married men.\\n-Nikola Tesla", "Those who are not shocked when they first come across quantum theory cannot possibly have understood it.\\n-Niels Bohr", "We\\u2019re not free in what we do, because we\\u2019re not free in what we want.\\n-Jonas Kahnwald", "What we know is a drop. What we don\\u2019t know is an ocean.\\n-Isaac Newton", "Oh fate, you mysterious bitch\\nWhy you doing this to me\\n-Theodore \\"T-Bag\\" Bagwell", "We are captives of our own identities, living in prisons of our own creation.\\n-Theodore \\"T-Bag\\" Bagwell", "Preparation can only take you so far. \\nAfter that, you have to take a few leaps of faith.\\n-Michael Scofield", "Das ist der Sound f\\u00fcr die echten M\\u00e4nner, die das hier h\\u00f6ren, wenn sie Pressluft h\\u00e4mmern\\n-Tarek Ebene, Nico Seyfrid & Maxim Dr\\u00fcner"]';
	function change_quote(){
		quotes = JSON.parse(quotes_str);
		quote = quotes[Math.floor(Math.random() * (quotes.length))];
		quote = quote.replace(/(?:\r\n|\r|\n)/g, '<br>');;
		document.getElementById("quote1").children[0].innerHTML = quote;
		document.getElementById("quote2").children[0].innerHTML = quote;
	}
	change_quote();

	// Register service worker to control making site work offline
	if('serviceWorker' in navigator) {
		window.addEventListener('load', function(){
			navigator.serviceWorker.register('sw.js', {scope: "/Fck/"}).then(function(registration) {
				console.log('Service Worker Registered');
				registration.onupdatefound = function() {
					if (navigator.serviceWorker.controller) {
						window.alert("Updated App, please reload page.");
					}
				}
			});
		});
	}
	</script>
</body>
</html>
